# K9s Plugin: Chronos Pod Scheduling Decision
# Shows scheduling decision for a specific pod

plugins:
  # Analyze scheduling decision for current pod
  chronos-decision:
    shortCut: Ctrl-D
    confirm: false
    description: "Show Chronos scheduling decision for this pod"
    scopes:
    - pods
    command: bash
    background: false
    args:
    - -c
    - |
      # Get the current pod name from K9s context
      POD_NAME="$1"
      PLUGINS_DIR="$HOME/.config/k9s/plugins"
      
      # Try JSON analysis first (more detailed), fallback to live logs
      if ls ${PLUGINS_DIR}/../*analysis*.json >/dev/null 2>&1; then
        JSON_FILE=$(ls -t ${PLUGINS_DIR}/../*analysis*.json | head -1)
        echo "ðŸ“Š Using JSON analysis: $(basename "$JSON_FILE")"
        ${PLUGINS_DIR}/show-json-decision.sh "$POD_NAME" "$JSON_FILE"
      else
        echo "ðŸ“± Using live log analysis"
        ${PLUGINS_DIR}/chronos-pod-decision.sh "$POD_NAME"
      fi
      
      echo -e "\nðŸ’¡ TIP: Place scheduler_analysis_*.json files in the project root for enhanced analysis"
      read -n 1 -s -r -p "Press any key to continue..."
    - $NAME
